{

    "$schema": "http://json-schema.org/draft-04/schema#",
    "description": "Schema for an xAPI Actor Property Agent",
    "id":"http://localhost:8080/agent.json",

    "type": "object",

    "allOf": [
        { "$ref": "#/definitions/base-agent" },
        { "$ref": "#/definitions/ifis" }
    ],

    "definitions": {
        "iri": {
            "type": "string",
            "pattern": "^[\\S]+:\\/?\\/?(?!\\/)[\\S]*$"
        },
        "base-agent": {
            "type": "object",

            "properties": {
                "objectType": { "$ref": "#/definitions/objectType" },
                "name": { "$ref": "#/definitions/name" }
            },
            "patternProperties": {
                "^mbox$": { "type": "string" },
                "^mbox_sha1sum$": { "type": "string" },
                "^openid": { "type": "string" },
                "^account$": { "type": "object" }
            },
            "additionalProperties": false
        },
        "ifis": {
            "oneOf": [
                { "$ref": "#/definitions/mbox" },
                { "$ref": "#/definitions/mbox_sha1sum" },
                { "$ref": "#/definitions/openid" },
                { "$ref": "#/definitions/account" }
            ]
        },
        "objectType": { "type": "string", "enum": [ "Agent" ] },
        "name": { "type": "string" },
        "mbox": {
            "properties": {
                "mbox": {
                    "type": "string",
                    "pattern": "^mailto:\\S+@\\S+\\.\\S+$"
                }
            },
            "required": [ "mbox" ]
        },
        "mbox_sha1sum": {
            "properties": {
                "mbox_sha1sum": {
                    "type": "string",
                    "pattern": "^[0-9a-fA-F]{40}$"
                }
            },
            "required": ["mbox_sha1sum"]
        },
        "openid": {
            "properties": {
                "openid": { "$ref": "#/definitions/iri" }
            },
            "required": [ "openid" ]
        },
        "account": {
            "properties": {
                "account": {
                    "type": "object",
                    "properties": {
                        "homePage": { "$ref": "#/definitions/iri" },
                        "name": { "type": "string" }
                    },
                    "required": [ "homePage", "name" ]
                }
            },
            "required": [ "account" ]
        }
    }

}
